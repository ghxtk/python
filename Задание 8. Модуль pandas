//Вариант 20

import pandas as pd
from scipy  import stats as sc
import numpy as np
import matplotlib.pyplot as plt


df1 = pd.read_csv('3-1.csv', delimiter=';')
df2 = pd.read_csv('3-2.csv', delimiter=';')
df3 = pd.read_csv('3-3.csv', delimiter=';')

//1) создайте таблицу продажи товаров от поставщика "Чай-кофе-сахар" за 8 июня, указав для каждой записи о продаже адрес магазина, 
//артикул товара, цену за упаковку, количество и общую стоимость проданных упаковок

merge_table = pd.merge(df2[df2["Поставщик"]=="\"Чай-кофе-сахар\""], df1[df1['Тип операции'] == "Продажа"])

#merge_table.sort_values('Дата').tail(5)

merge_table2 = pd.merge(merge_table[merge_table['Дата'] == "01.06.2021"], df3)
new_table = merge_table2[['Адрес','Артикул','Цена руб./шт.', 'Количество упаковок, шт.']]
new_table = new_table.assign(Общая_стоимость_упаковок = merge_table2['Цена руб./шт.'] * merge_table2['Количество упаковок, шт.'])
new_table 

//Адрес	Артикул	Цена руб./шт.	Количество упаковок, шт.	Общая_стоимость_упаковок
//0	просп. Мира, 45	28	38	133	5054
//1	просп. Мира, 45	29	85	27	2295
//2	просп. Мира, 45	30	44	106	4664
//3	просп. Мира, 45	44	180	80	14400
//4	просп. Мира, 45	45	170	53	9010
//...	...	...	...	...	...
//123	Прибрежная, 7	44	180	56	10080
//124	Прибрежная, 7	45	170	37	6290
//125	Прибрежная, 7	46	330	74	24420
//126	Прибрежная, 7	47	370	23	8510
//127	Прибрежная, 7	48	180	56	10

//2) постройте круговую диаграмму выручки от продажи разных круп от поставщика Продбаза во всех магазинах (суммарно) в период со 2 по 4 июня включительно

merge_tb = pd.merge(df2[(df2["Поставщик"]=="Продбаза") &((df2['Наименование товара']=="Крупа гречневая ядрица")|
                                                         (df2['Наименование товара']=="Крупа перловая")|
                                                         (df2['Наименование товара']=="Крупа пшено")|
                                                         (df2['Наименование товара']=="Крупа манная"))], 
                    df1[(df1['Дата'] >= "02.06.2021") & 
                  (df1['Дата'] <= "04.06.2021") & (df1['Тип операции'] == "Продажа")])


new_tb = merge_tb.groupby('Наименование товара').aggregate(['count'])['Артикул']
new_tb.plot(kind='pie', fontsize=15, autopct='%1.1f%%', subplots=True)
plt.show()

//(какая та круговая диаграмма с 33.3% круп там всяких)  

//3) постройте график изменения количества упаковок яиц диетических, имеющихся в наличии в магазинах Октябрьского района и в двух магазинах на улице Заводской, 
//за период со 2 по 8 июня включительно

merge_tb1 = pd.merge(pd.merge(df2[df2['Наименование товара']=="Яйцо диетическое"],
                    df1[(df1['Дата'] >= "02.06.2021") & 
                  (df1['Дата'] <= "08.06.2021") & (df1['Тип операции'] == "Продажа")]),
                   df3[(df3['Район'] == "Октябрьский") |
                       (str(df3['Адрес']).find("Заводская") != -1)]).filter(items = ['Дата', 'Количество упаковок, шт.'])


graph = merge_tb1.groupby('Дата').aggregate(['count'])

print(graph)

graph.plot()
plt.show()

//Количество упаковок, шт. (тут еще график прямой y= 16)
                              count
Дата                               
04.06.2021                       16
08.06.2021                       16
